// ==UserScript==
// @name         price history tracker
// @namespace    Violentmonkey Scripts
// @version      1.0
// @description  Adds a button to redirect from flipkart.com to pricehistoryapp.com for the product being viewed
// @author       dude-with-the-long-username
// @match        https://www.flipkart.com/*
// @icon         https://pricehistoryapp.com/images/favicons/favicon-32x32.png
// @grant        none
// @license      GPLv3
// ==/UserScript==

(function() {
    'use strict';
    // Create a button
    var redirectButton = document.createElement("button");
    // base64 encoded string of image
    const iconUrl = "data:image/png;base64,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";
    // const spinningUrl = "data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20style='margin:%20auto;%20background:%20rgb(255,%20255,%20255);%20display:%20block;%20shape-rendering:%20auto;'%20width='200px'%20height='200px'%20viewBox='0%200%20100%20100'%20preserveAspectRatio='xMidYMid'%3e%3cg%20transform='rotate(0%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='-0.9166666666666666s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3cg%20transform='rotate(30%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='-0.8333333333333334s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3cg%20transform='rotate(60%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='-0.75s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3cg%20transform='rotate(90%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='-0.6666666666666666s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3cg%20transform='rotate(120%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='-0.5833333333333334s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3cg%20transform='rotate(150%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='-0.5s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3cg%20transform='rotate(180%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='-0.4166666666666667s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3cg%20transform='rotate(210%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='-0.3333333333333333s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3cg%20transform='rotate(240%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='-0.25s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3cg%20transform='rotate(270%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='-0.16666666666666666s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3cg%20transform='rotate(300%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='-0.08333333333333333s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3cg%20transform='rotate(330%2050%2050)'%3e%3crect%20x='47'%20y='24'%20rx='3'%20ry='6'%20width='6'%20height='12'%20fill='%23000000'%3e%3canimate%20attributeName='opacity'%20values='1;0'%20keyTimes='0;1'%20dur='1s'%20begin='0s'%20repeatCount='indefinite'%3e%3c/animate%3e%3c/rect%3e%3c/g%3e%3c!--%20[ldio]%20generated%20by%20https://loading.io/%20--%3e%3c/svg%3e";
    // redirectButton.innerHTML = "price history";
    redirectButton.title = "Open in price history";
    redirectButton.style.position = "fixed";
    redirectButton.style.top = "calc(100% - 61.8vh)";
    redirectButton.style.left = "0px";
    redirectButton.style.zIndex = "10000";
    const img = document.createElement("img");
    img.alt = "icon";
    img.src = iconUrl;
    redirectButton.appendChild(img);
    var productUrl = window.location.href.split("/");
    var productSubstring = productUrl.replace("https://www.flipkart.com/", "");
    redirectButton.addEventListener ("click", function() {
        window.open("https://pricehistoryapp.com/product/" + productSubstring, "_blank");
    });
    document.body.appendChild(redirectButton);
})();